---
title: Comparison of Bayesian and frequentist MMRM fits using example datasets
date: "`r format(Sys.time(), '%d/%m/%Y')`"
output:
  rmarkdown::html_document:
    theme: spacelab
    highlight: default
    toc: yes
    toc_float: yes
    number_sections: true  
vignette: |
  %\VignetteIndexEntry{Comparison of Bayesian and frequentist MMRM fits using example datasets}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown} 
editor_options:
  chunk_output_type: console
  markdown:
    wrap: 72
---

```{r setup, eval=T, include=F, warning=F, message=F}
rm(list = ls())
library(knitr)
knitr::opts_chunk$set( 
  echo = T, collapse = T, warning = F, message = F, 
  prompt = T, comment = NA, size = "scriptsize",
  fig.height = 5, fig.width = 6, dpi = 320, 
  fig.align = "center", fig.path="figures/"
  )
```

# About {.unnumbered}

This is a comparison of Bayesian MMRM fits, obtained by `brms.mmrm::brm_model()`, and frequentist MMRM fits, obtained by `mmrm::mmrm()`, using an example dataset.

# Prerequisites

Load general packages:

```{r load_gen_pkgs, eval=T, echo=T}
packages <- c("tidyr", "dplyr", "stringr", "tibble", "forcats")
invisible(lapply(packages, library, character.only = T))
```

Load packages providing example datasets:

```{r load_dat_pkgs, eval=T, echo=T}
library("Hmisc")
library("HSAUR3")
```

Load MMRM packages:

```{r load_mmrm_pkgs, eval=T, echo=T}
#if (!require("remotes")) {install.packages("remotes")}
#remotes::install_github("openpharma/brms.mmrm")
library(brms.mmrm)
#remotes::install_github("openpharma/mmrm")
library(mmrm)
library(emmeans)
```

Set seed:

```{r set_seed, eval=T, echo=T}
set.seed(123L)
```


# Cervical dystonia data

A description of the `cdystonia` dataset is available [here](https://hbiostat.org/data/repo/cdystonia).

<!--
Reduced to two groups.
TWSTRS-total scores from 109 patients with cervical dystonia: First 35 subjects
-->

## Data pre-processing 

```{r cdystonia1, eval=T, echo=T}
getHdata(cdystonia)
cdystonia1 <- cdystonia |>
  filter(treat %in% c("10000U", "Placebo")) |> # restrict to two arms
  droplevels() |>
  mutate(
    week = paste0("w", sprintf("%02d", week)), # convert to character variable
    id = paste0(site, "-", sprintf("%02d", id)), # create unique id
  ) |>
  select(-c(site)) |>
  arrange(id, week) |>
  brm_data( # create and preprocess MMRM dataset
    outcome = "twstrs",
    role = "response",
    group = "treat",
    time = "week",
    patient = "id",
    level_control = "Placebo",
    level_baseline = "w00"
  ) |>
  brm_data_change(name_change = "delta") |> # convert to change from baseline
  filter(!is.na(delta))
```

```{r cdystonia2, eval=T, echo=T}
head(cdystonia1)
```

## Descriptive statistics

```{r cdystonia3, eval=T, echo=T}
cdystonia1 |> group_by(treat) |> tally() 
cdystonia1 |> group_by(week) |> tally()
cdystonia1 |> group_by(treat, week) |> tally()
```



## Fitting MMRMs

...

## Comparison 

...



# HSAUR3 data

## Data pre-processing

...

## Descriptive statistics
...

## Fitting MMRMs

...

## Comparison 

...


```{r figure1, eval=F, echo=F, fig.align='center', fig.width=8, fig.height=5, fig.keep='all', fig.pos="!ht", dev=c('pdf', 'png'), out.width="0.9\\textwidth", fig.cap="..."}
```

# References {.unnumbered}

## Literature {.unnumbered}

...

<!--
&nbsp;

<div id="refs"></div>

&nbsp;
-->


## Session info {.unnumbered}

```{r citation_session, echo=T, eval=T, message=F}
sessionInfo()
```
