<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulation-based calibration • brms.mmrm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulation-based calibration">
<meta property="og:description" content="brms.mmrm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brms.mmrm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.2.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/brms.mmrm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulation-based calibration</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/brms.mmrm/blob/HEAD/vignettes/sbc.Rmd" class="external-link"><code>vignettes/sbc.Rmd</code></a></small>
      <div class="hidden name"><code>sbc.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="about">About<a class="anchor" aria-label="anchor" href="#about"></a>
</h2>
<p>This vignette shows the results of a simulation-based calibration
(SBC) study to validate the implementation of the models in
<code>brms.mmrm</code>. SBC tests the ability of a Bayesian model to
recapture the parameters used to simulate prior predictive data. For
details on SBC, please read <span class="citation">Talts et al.
(2020)</span> and the <a href="https://hyunjimoon.github.io/SBC/" class="external-link"><code>SBC</code></a> R package
<span class="citation">(Kim et al. 2022)</span>. This particular SBC
study uses the <a href="https://docs.ropensci.org/targets/" class="external-link"><code>targets</code></a>
pipeline in the <a href="https://github.com/openpharma/brms.mmrm/tree/main/sbc" class="external-link"><code>sbc</code></a>
subdirectory of the <a href="https://github.com/openpharma/brms.mmrm" class="external-link"><code>brms.mmrm</code></a>
package source code.</p>
</div>
<div class="section level2">
<h2 id="simple-scenario">Simple scenario<a class="anchor" aria-label="anchor" href="#simple-scenario"></a>
</h2>
<p>In the simple scenario, we simulate datasets from the prior
predictive distribution assuming 3 treatment groups, 4 time points, 100
patients per treatment group, no adjustment for covariates, and no
missing responses. The model formula is:</p>
<pre><code><span><span class="co">#&gt; response ~ 0 + group + time + unstr(time = time, gr = patient) </span></span>
<span><span class="co">#&gt; sigma ~ 0 + time</span></span></code></pre>
<p>The prior was randomly generated and used for both simulation and
analysis:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu">fst</span><span class="fu">::</span><span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html" class="external-link">read_fst</a></span><span class="op">(</span><span class="st">"sbc/prior_simple.fst"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 4</span></span></span>
<span><span class="co">#&gt;    prior                     class    coef           dpar   </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> lkj_corr_cholesky(1.3841) Lcortime <span style="color: #949494;">""</span>             <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> normal(0.1689, 2.5044)    b        <span style="color: #949494;">"</span>groupgroup_2<span style="color: #949494;">"</span> <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> normal(0.1214, 1.4494)    b        <span style="color: #949494;">"</span>groupgroup_3<span style="color: #949494;">"</span> <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> normal(0.128, 1.3121)     b        <span style="color: #949494;">"</span>timetime_1<span style="color: #949494;">"</span>   <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> normal(-0.1185, 1.4261)   b        <span style="color: #949494;">"</span>timetime_2<span style="color: #949494;">"</span>   <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> normal(-0.1265, 1.0435)   b        <span style="color: #949494;">"</span>timetime_3<span style="color: #949494;">"</span>   <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> normal(-0.0028, 1.4913)   b        <span style="color: #949494;">"</span>timetime_4<span style="color: #949494;">"</span>   <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> normal(0.173, 1.2153)     b        <span style="color: #949494;">"</span>timetime_1<span style="color: #949494;">"</span>   <span style="color: #949494;">"</span>sigma<span style="color: #949494;">"</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> normal(0.1612, 1.2679)    b        <span style="color: #949494;">"</span>timetime_2<span style="color: #949494;">"</span>   <span style="color: #949494;">"</span>sigma<span style="color: #949494;">"</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> normal(0.1899, 1.7307)    b        <span style="color: #949494;">"</span>timetime_3<span style="color: #949494;">"</span>   <span style="color: #949494;">"</span>sigma<span style="color: #949494;">"</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> normal(-0.0949, 1.3566)   b        <span style="color: #949494;">"</span>timetime_4<span style="color: #949494;">"</span>   <span style="color: #949494;">"</span>sigma<span style="color: #949494;">"</span></span></span></code></pre></div>
<p>The following histograms show the SBC rank statistics which compare
the prior parameter draws draws to the posterior draws. If the data
simulation code and modeling code are both correct and consistent, then
the rank statistics should be uniformly distributed.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">read_ranks</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">fst</span><span class="fu">::</span><span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html" class="external-link">read_fst</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      names_to <span class="op">=</span> <span class="st">"parameter"</span>,</span>
<span>      values_to <span class="op">=</span> <span class="st">"rank"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plot_ranks</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rank</span><span class="op">)</span>,</span>
<span>      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">$</span><span class="va">rank</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">parameter</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_ranks</span> <span class="op">&lt;-</span> <span class="fu">read_ranks</span><span class="op">(</span><span class="st">"sbc/simple.fst"</span><span class="op">)</span></span></code></pre></div>
<p>Fixed effect parameter ranks:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_ranks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-6-1.png" width="672">
Log-scale standard deviation parameter ranks:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_ranks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>Correlation parameter ranks:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_ranks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"cortime_"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="complex-scenario">Complex scenario<a class="anchor" aria-label="anchor" href="#complex-scenario"></a>
</h2>
<p>In the complex scenario, we simulate datasets from the prior
predictive distribution assuming 2 treatment groups, 3 time points, 150
patients per treatment group, adjustment for two continuous and two
categorical baseline covariates, 30% dropout, and an 8% rate of
independent/sporadic missing values. The model formula is:</p>
<pre><code><span><span class="co">#&gt; response ~ group + group:time + time + continuous1 + continuous2 + balanced + unbalanced + unstr(time = time, gr = patient) </span></span>
<span><span class="co">#&gt; sigma ~ 0 + time</span></span></code></pre>
<p>The prior was randomly generated and used for both simulation and
analysis:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu">fst</span><span class="fu">::</span><span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html" class="external-link">read_fst</a></span><span class="op">(</span><span class="st">"sbc/prior_complex.fst"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 4</span></span></span>
<span><span class="co">#&gt;    prior                     class     coef                      dpar   </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> lkj_corr_cholesky(1.4798) Lcortime  <span style="color: #949494;">""</span>                        <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> normal(-0.0596, 1.8135)   Intercept <span style="color: #949494;">""</span>                        <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> normal(-0.1652, 0.6118)   b         <span style="color: #949494;">"</span>balancedlevel2<span style="color: #949494;">"</span>          <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> normal(0.2447, 1.9717)    b         <span style="color: #949494;">"</span>balancedlevel3<span style="color: #949494;">"</span>          <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> normal(-0.074, 0.7745)    b         <span style="color: #949494;">"</span>continuous1<span style="color: #949494;">"</span>             <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> normal(-0.0766, 0.9556)   b         <span style="color: #949494;">"</span>continuous2<span style="color: #949494;">"</span>             <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> normal(-0.1736, 1.2109)   b         <span style="color: #949494;">"</span>groupgroup_2<span style="color: #949494;">"</span>            <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> normal(-0.1923, 2.2843)   b         <span style="color: #949494;">"</span>timetime_2<span style="color: #949494;">"</span>              <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> normal(0.0334, 0.4699)    b         <span style="color: #949494;">"</span>timetime_2:groupgroup_2<span style="color: #949494;">"</span> <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> normal(0.0309, 2.3703)    b         <span style="color: #949494;">"</span>timetime_3<span style="color: #949494;">"</span>              <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> normal(0.1742, 1.722)     b         <span style="color: #949494;">"</span>timetime_3:groupgroup_2<span style="color: #949494;">"</span> <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> normal(-0.2019, 2.9989)   b         <span style="color: #949494;">"</span>unbalancedlevel2<span style="color: #949494;">"</span>        <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> normal(-0.0413, 1.1137)   b         <span style="color: #949494;">"</span>unbalancedlevel3<span style="color: #949494;">"</span>        <span style="color: #949494;">""</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> normal(-0.2011, 1.0844)   b         <span style="color: #949494;">"</span>timetime_1<span style="color: #949494;">"</span>              <span style="color: #949494;">"</span>sigma<span style="color: #949494;">"</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> normal(-0.1601, 2.648)    b         <span style="color: #949494;">"</span>timetime_2<span style="color: #949494;">"</span>              <span style="color: #949494;">"</span>sigma<span style="color: #949494;">"</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> normal(-0.2176, 2.0724)   b         <span style="color: #949494;">"</span>timetime_3<span style="color: #949494;">"</span>              <span style="color: #949494;">"</span>sigma<span style="color: #949494;">"</span></span></span></code></pre></div>
<p>The following histograms show the SBC rank statistics which compare
the prior parameter draws draws to the posterior draws. If the data
simulation code and modeling code are both correct and consistent, then
the rank statistics should be uniformly distributed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">complex_ranks</span> <span class="op">&lt;-</span> <span class="fu">read_ranks</span><span class="op">(</span><span class="st">"sbc/complex.fst"</span><span class="op">)</span></span></code></pre></div>
<p>Fixed effect parameter ranks:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">complex_ranks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-12-1.png" width="672">
Log-scale standard deviation parameter ranks:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">complex_ranks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>Correlation parameter ranks:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">complex_ranks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"cortime_"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The SBC rank statistics look uniformly distributed. In other words,
the posterior distribution from the <code>brms</code>/Stan MMRM modeling
code matches the prior from which the datasets were simulated. This is
evidence that the model in <code>brms.mmrm</code> is implemented
correctly.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-sbc" class="csl-entry">
Kim, S., Moon, H., Modrák, M., and Säilynoja, T. (2022), <em>SBC:
Simulation based calibration for rstan/cmdstanr models</em>.
</div>
<div id="ref-talts2020" class="csl-entry">
Talts, S., Betancourt, M., Simpson, D., Vehtari, A., and Gelman, A.
(2020), <span>“<a href="https://arxiv.org/abs/1804.06788" class="external-link">Validating
bayesian inference algorithms with simulation-based
calibration</a>.”</span>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by William Michael Landau, Kevin Kunzmann, Yoni Sidi, Christian Stock, Eli Lilly and Company, Boehringer Ingelheim Pharma GmbH &amp; Co. KG.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
