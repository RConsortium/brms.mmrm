<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Methods • brms.mmrm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Methods">
<meta property="og:description" content="brms.mmrm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brms.mmrm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.2.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/comparison.html">Comparison of Bayesian and frequentist MMRM fits</a>
    </li>
    <li>
      <a href="../articles/methods.html">Methods</a>
    </li>
    <li>
      <a href="../articles/sbc.html">Simulation-based calibration</a>
    </li>
    <li>
      <a href="../articles/simulation.html">Simulation</a>
    </li>
    <li>
      <a href="../articles/usage.html">Usage</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/brms.mmrm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Methods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/brms.mmrm/blob/HEAD/vignettes/methods.Rmd" class="external-link"><code>vignettes/methods.Rmd</code></a></small>
      <div class="hidden name"><code>methods.Rmd</code></div>

    </div>

    
    
<p>The <code>brms.mmrm</code> R package implements a mixed model of
repeated measures (MMRM) <span class="citation">(Mallinckrodt et al.
2008)</span>, a popular and flexible model to analyze continuous
longitudinal outcomes. <code>brms.mmrm</code> focuses on marginal MMRMs
for randomized controlled parallel studies with discrete time points,
where each subject shares the same set of time points. Whereas the <a href="https://openpharma.github.io/mmrm/" class="external-link"><code>mmrm</code></a> package
is frequentist, <code>brms.mmrm</code> fits models in Bayesian fashion
using <a href="https://paul-buerkner.github.io/brms/" class="external-link"><code>brms</code></a> <span class="citation">(Bürkner 2017)</span>.</p>
<div class="section level2">
<h2 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h2>
<p>The MMRM in <code>brms.mmrm</code> is mathematically expressed as
follows. Subsequent sections define notation, data, parameters, and
priors.</p>
<p><span class="math display">\[
\begin{aligned}
&amp;y_i \stackrel{\text{ind}}{\sim} \text{Multivariate-Normal} \left
(\text{mean} = X_{i} \beta, \ \text{covariance} = \text{diag}(\sigma)
\cdot \Lambda \cdot \text{diag}(\sigma) \right ) \\
&amp;\qquad \beta_p \stackrel{\text{ind}}{\sim} q_p() \\
&amp;\qquad \Lambda \sim r() \\
&amp;\qquad \tau = \log(\sigma) \\
&amp;\qquad \qquad \tau_t \stackrel{\text{ind}}{\sim} s_t()
\end{aligned}
\]</span></p>
</div>
<div class="section level2">
<h2 id="notation">Notation<a class="anchor" aria-label="anchor" href="#notation"></a>
</h2>
<ul>
<li>
<span class="math inline">\(i\)</span>: positive integer index of a
subject or patient in the study.</li>
<li>
<span class="math inline">\(t\)</span>: positive integer index of a
discrete time point in the study.</li>
<li>
<span class="math inline">\(p\)</span>: positive integer index of a
model coefficient parameter <span class="math inline">\(\beta_p\)</span>.</li>
<li>
<span class="math inline">\(\theta_j \stackrel{\text{ind}}{\sim}
f()\)</span>: assuming <span class="math inline">\(j\)</span> is a
positive integer index that ranges from 1 to positive integer <span class="math inline">\(J\)</span>, this notation declares that parameters
<span class="math inline">\(\theta_1, \ldots, \theta_J\)</span> are
independent and each follow the prior distribution with a common
probability density function <span class="math inline">\(f()\)</span>.</li>
<li>
<span class="math inline">\(\theta_j \stackrel{\text{ind}}{\sim}
f_j()\)</span>: same as above, except each <span class="math inline">\(\theta_j\)</span> parameter follows its own
separate prior distribution with probability density function <span class="math inline">\(p_j()\)</span>. <span class="math inline">\(p_i()\)</span> and <span class="math inline">\(f_j()\)</span> may differ if <span class="math inline">\(i \ne j\)</span>.</li>
<li>
<span class="math inline">\(\text{diag}(\theta)\)</span>: diagonal
matrix with the scalar elements of vector <span class="math inline">\(\theta\)</span> on the diagonal and off-diagonal
elements equal to 0. The number of rows and number of columns in this
matrix are both equal to the number of elements in vector <span class="math inline">\(\theta\)</span>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<ul>
<li>
<span class="math inline">\(y_i\)</span>: numeric vector of outcome
observations for subject <span class="math inline">\(i\)</span>. The
number of elements in the vector equals the number of discrete time
points in the study, and for the purposes of this model specification,
they are sorted chronologically with the first element of <span class="math inline">\(y_i\)</span> observed first in the study. One or
more elements of each <span class="math inline">\(y_i\)</span> may be
missing due to dropout, discontinuation, etc. The likelihood of the
model assumes <span class="math inline">\(y_i\)</span> is independent of
<span class="math inline">\(y_j\)</span> for <span class="math inline">\(i \ne j\)</span>.</li>
<li>
<span class="math inline">\(X_i\)</span>: a matrix containing the
rows of the model matrix that correspond to subject <span class="math inline">\(i\)</span>. The rows of <span class="math inline">\(X_i\)</span> correspond to the elements of the
vector <span class="math inline">\(y_i\)</span> (equivalently, the
discrete time points of the study), and the columns of <span class="math inline">\(X_i\)</span> correspond to the model coefficient
parameters <span class="math inline">\(\beta_p\)</span>. The composition
of <span class="math inline">\(X_i\)</span> is determined by the
covariates in the input dataset and the choice of model formula supplied
by the user (via <code><a href="../reference/brm_formula.html">brm_formula()</a></code>).</li>
</ul>
</div>
<div class="section level2">
<h2 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h2>
<ul>
<li>
<span class="math inline">\(\beta\)</span>: vector of model
coefficients. <span class="math inline">\(\beta_p\)</span> is scalar
element <span class="math inline">\(p\)</span> of <span class="math inline">\(\beta\)</span>.</li>
<li>
<span class="math inline">\(\Lambda\)</span>: matrix of pairwise
correlations among each pair of time points within subjects. Outcomes
measured from different subjects are assumed to be independent, and
outcomes observed at different time points for the same subject are
assumed to be correlated according to this matrix. <span class="math inline">\(\Lambda\)</span> is positive-definite and
symmetric, and the number of rows and columns is equal to the number of
discrete time points of the study.</li>
<li>
<span class="math inline">\(\sigma\)</span>: vector of
time-point-specific standard deviations of the residuals on the linear
scale. <span class="math inline">\(\sigma_t\)</span> is scalar element
<span class="math inline">\(t\)</span> of <span class="math inline">\(\sigma\)</span>.</li>
<li>
<span class="math inline">\(\tau\)</span>: same as <span class="math inline">\(\sigma\)</span>, but on the natural logarithmic
scale. Each scalar element <span class="math inline">\(\tau_t\)</span>
of <span class="math inline">\(\tau\)</span> is defined as the natural
logarithm of <span class="math inline">\(\sigma_t\)</span>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h2>
<p>The priors on the parameters depend on the <code>prior</code>
argument of <code><a href="../reference/brm_model.html">brm_model()</a></code> and related functions. If priors
are not specified by the user, then the <a href="https://paul-buerkner.github.io/brms/" class="external-link"><code>brms</code></a>
package sets defaults. You can view the default priors using the <a href="http://paul-buerkner.github.io/brms/reference/get_prior.html" class="external-link"><code>get_prior()</code></a>
function in <a href="https://paul-buerkner.github.io/brms/" class="external-link"><code>brms</code></a>. See
the <a href="https://paul-buerkner.github.io/brms/" class="external-link"><code>brms</code></a> for
information on how <a href="https://paul-buerkner.github.io/brms/" class="external-link"><code>brms</code></a> sets
default priors.</p>
<ul>
<li>
<span class="math inline">\(q_p()\)</span>: univariate prior on the
model coefficient <span class="math inline">\(\beta_p\)</span>.</li>
<li>
<span class="math inline">\(r()\)</span>: matrix prior on the
within-subject residual correlation matrix parameter <span class="math inline">\(\Lambda\)</span>.</li>
<li>
<span class="math inline">\(s_t()\)</span>: univariate prior on the
natural-log-standard-deviation parameter <span class="math inline">\(\tau_t\)</span> of discrete time point <span class="math inline">\(t\)</span>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="sampling">Sampling<a class="anchor" aria-label="anchor" href="#sampling"></a>
</h2>
<p><code>brms.mmrm</code>, through <a href="https://paul-buerkner.github.io/brms/" class="external-link"><code>brms</code></a>, fits
the model to the data using the Markov chain Monte Carlo (MCMC)
capabilities of <a href="https://mc-stan.org/" class="external-link">Stan</a> <span class="citation">(Stan Development Team 2023)</span>. Please read <a href="https://mc-stan.org/users/documentation/" class="external-link uri">https://mc-stan.org/users/documentation/</a> for more
details on the methodology of <a href="https://mc-stan.org/" class="external-link">Stan</a>.
The result of MCMC is a collection of draws from the full joint
posterior distribution of the parameters given the data. Individual
draws of scalar parameters such as <span class="math inline">\(\beta_3\)</span> are considered draws from the
marginal posterior distribution of e.g. <span class="math inline">\(\beta_3\)</span> given the data.</p>
</div>
<div class="section level2">
<h2 id="inference">Inference<a class="anchor" aria-label="anchor" href="#inference"></a>
</h2>
<p>Inference in <code>brms.mmrm</code>, uses the estimated marginal
posterior distribution of the mean response at each combination of study
arm and time point. The <a href="https://github.com/rvlenth/emmeans" class="external-link"><code>emmeans</code></a>
package <span class="citation">(Lenth 2016)</span> derives these
marginal posteriors while averaging over other covariates as nuisance
parameters. During this averaging process, the levels of categorical
nuisance parameters are weighted proportionally to their frequencies in
the dataset (with <code>wt.nuis = "proportional"</code> in
<code><a href="https://rdrr.io/pkg/emmeans/man/ref_grid.html" class="external-link">emmeans::ref_grid()</a></code>).</p>
<p>The <code><a href="../reference/brm_marginal_draws.html">brm_marginal_draws()</a></code> function, described in the
usage vignette, derives posterior draws of the marginals using posterior
draws of the model coefficients <span class="math inline">\(\beta_p\)</span>. Then, downstream functions like
<code><a href="../reference/brm_marginal_probabilities.html">brm_marginal_probabilities()</a></code> compute numerical summaries of
these marginal draws.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-burkner2017" class="csl-entry">
Bürkner, P.-C. (2017), <span>“<span class="nocase">brms</span>: An
<span>R</span> package for <span>Bayesian</span> multilevel models using
<span>Stan</span>,”</span> <em>Journal of Statistical Software</em>, 80,
1–28. <a href="https://doi.org/10.18637/jss.v080.i01" class="external-link">https://doi.org/10.18637/jss.v080.i01</a>.
</div>
<div id="ref-lenth2016" class="csl-entry">
Lenth, R. V. (2016), <span>“Least-squares means: The r package
lsmeans,”</span> <em>Journal of Statistical Software</em>, 69, 1–33. <a href="https://doi.org/10.18637/jss.v069.i01" class="external-link">https://doi.org/10.18637/jss.v069.i01</a>.
</div>
<div id="ref-mallinckrodt2008" class="csl-entry">
Mallinckrodt, C. H., Lane, P. W., Schnell, D., and others (2008),
<span>“Recommendations for the primary analysis of continuous endpoints
in longitudinal clinical trials,”</span> <em>Ther Innov Regul Sci</em>,
42, 303–319. <a href="https://doi.org/10.1177/009286150804200402" class="external-link">https://doi.org/10.1177/009286150804200402</a>.
</div>
<div id="ref-stan2023" class="csl-entry">
Stan Development Team (2023), <em><a href="https://mc-stan.org" class="external-link">Stan
modeling language users guide and reference manual</a></em>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by William Michael Landau, Kevin Kunzmann, Yoni Sidi, Christian Stock, Eli Lilly and Company, Boehringer Ingelheim Pharma GmbH &amp; Co. KG.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
