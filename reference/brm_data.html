<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Create a dataset to analyze with an MMRM."><title>Create and preprocess an MMRM dataset. — brm_data • brms.mmrm</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create and preprocess an MMRM dataset. — brm_data"><meta property="og:description" content="Create a dataset to analyze with an MMRM."><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">brms.mmrm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9004</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Usage</h6>
    <a class="dropdown-item" href="../articles/usage.html">Usage</a>
    <a class="dropdown-item" href="../articles/subgroup.html">Subgroup analysis</a>
    <a class="dropdown-item" href="../articles/simulation.html">Simulation</a>
    <a class="dropdown-item" href="../articles/archetypes.html">Informative prior archetypes</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Validation</h6>
    <a class="dropdown-item" href="../articles/sbc.html">Simulation-based calibration checking</a>
    <a class="dropdown-item" href="../articles/fev1.html">FEV1 data comparison between Bayesian and frequentist MMRMs</a>
    <a class="dropdown-item" href="../articles/bcva.html">BCVA data comparison between Bayesian and frequentist MMRMs</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/openpharma/brms.mmrm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Create and preprocess an MMRM dataset.</h1>
      <small class="dont-index">Source: <a href="https://github.com/openpharma/brms.mmrm/blob/HEAD/R/brm_data.R" class="external-link"><code>R/brm_data.R</code></a></small>
      <div class="d-none name"><code>brm_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a dataset to analyze with an MMRM.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">brm_data</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"CHG"</span>,</span>
<span>  role <span class="op">=</span> <span class="st">"change"</span>,</span>
<span>  baseline <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  subgroup <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"AVISIT"</span>,</span>
<span>  patient <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0L</span><span class="op">)</span>,</span>
<span>  missing <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  reference_group <span class="op">=</span> <span class="st">"Placebo"</span>,</span>
<span>  level_control <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  reference_subgroup <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  reference_time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  level_baseline <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>Data frame or tibble with longitudinal data.</p></dd>


<dt>outcome</dt>
<dd><p>Character of length 1, name of the outcome variable.</p></dd>


<dt>role</dt>
<dd><p>Character of length 1. Either <code>"response"</code> if <code>outcome</code>
is the raw response variable (e.g. AVAL) or <code>"change"</code> if <code>outcome</code>
is change from baseline (e.g. CHG).</p></dd>


<dt>baseline</dt>
<dd><p>Character of length 1,
name of the baseline response variable.
Only relevant if the response variable is change from baseline.
Supply <code>NULL</code> to ignore or omit.</p></dd>


<dt>group</dt>
<dd><p>Character of length 1, name of the treatment group variable.
Must point to a character vector in the data. Factors are converted
to characters.</p></dd>


<dt>subgroup</dt>
<dd><p>Character of length 1, optional name of the a
discrete subgroup variable. Set to <code>NULL</code> to omit the subgroup (default).</p></dd>


<dt>time</dt>
<dd><p>Character of length 1, name of the discrete time variable.
Must point to a character vector in the data. Factors are converted
to characters.</p></dd>


<dt>patient</dt>
<dd><p>Character of length 1, name of the patient ID variable.</p></dd>


<dt>covariates</dt>
<dd><p>Character vector of names of other covariates.</p></dd>


<dt>missing</dt>
<dd><p>Character of length 1, name of an optional variable
in a simulated dataset to indicate which outcome values should be missing.
Set to <code>NULL</code> to omit.</p></dd>


<dt>reference_group</dt>
<dd><p>Character of length 1, Level of the <code>group</code> column
to indicate the control group.
<code>reference_group</code> only applies to the post-processing that happens
in functions like <code><a href="brm_marginal_draws.html">brm_marginal_draws()</a></code> downstream of the model.
It does not control the fixed effect mapping in the
model matrix that <code>brms</code> derives from the formula from <code><a href="brm_formula.html">brm_formula()</a></code>.</p></dd>


<dt>level_control</dt>
<dd><p>Deprecated on 2024-01-11 (version 0.2.0.9002).
Use <code>reference_group</code> instead.</p></dd>


<dt>reference_subgroup</dt>
<dd><p>Character of length 1,
level of the <code>subgroup</code> column
to use as a reference for pairwise differences in when computing
marginal means downstream of the model.
It does not control the fixed effect mapping in the
model matrix that <code>brms</code> derives from the formula from <code><a href="brm_formula.html">brm_formula()</a></code>.</p></dd>


<dt>reference_time</dt>
<dd><p>Character of length 1 or <code>NULL</code>,
level of the <code>time</code> column to indicate the baseline time point.
This value should not be present in the data if the outcome
variable is change from baseline, but it must be in the data
if the outcome variable is the raw response so that <code>brms.mmrm</code>
can produce model-based marginal estimates of change from baseline.
In other words, set <code>reference_time</code> to <code>NULL</code> if <code>role</code> is <code>"change"</code>,
and set <code>reference_time</code> to a non-null value in <code>data[[time]]</code>
if <code>role</code> is <code>"response"</code>.</p>
<p>Note: <code>reference_time</code> only applies to the post-processing that happens
in functions like <code><a href="brm_marginal_draws.html">brm_marginal_draws()</a></code> downstream of the model.
It does not control the fixed effect mapping in the
model matrix that <code>brms</code> derives from the formula from <code><a href="brm_formula.html">brm_formula()</a></code>.</p></dd>


<dt>level_baseline</dt>
<dd><p>Deprecated on 2024-01-11 (version 0.2.0.9002).
Use <code>reference_time</code> instead.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A classed tibble with attributes which denote features of
the data such as the treatment group and discrete time variables.</p>
    </div>
    <div class="section level2">
    <h2 id="preprocessing">Preprocessing<a class="anchor" aria-label="anchor" href="#preprocessing"></a></h2>
    

<p>The preprocessing steps in <code>brm_data()</code> are as follows:</p><ul><li><p>Perform basic assertions to make sure the data and other arguments
are properly formatted.</p></li>
<li><p>Convert the group and time columns to character vectors.</p></li>
<li><p>Sanitize the levels of the group and time columns using
<code>make.names(unique = FALSE, allow_ = TRUE)</code> to ensure agreement
between the data and the output of <code>brms</code>.</p></li>
<li><p>For each implicitly missing outcome observation, add explicit row
with the outcome variable equal to <code>NA_real_</code>.</p></li>
<li><p>Arrange the rows of the data by group, then patient, then discrete time.</p></li>
<li><p>Select only the columns of the data relevant to an MMRM analysis.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="separation-string">Separation string<a class="anchor" aria-label="anchor" href="#separation-string"></a></h2>
    

<p>Post-processing in <code><a href="brm_marginal_draws.html">brm_marginal_draws()</a></code> names each of the
group-by-time marginal means with the delimiting character string
from <code>Sys.getenv("BRM_SEP", unset = "|")</code>. Neither the column names
nor element names of the group and time variables can contain
this string. To set a custom string yourself, use
<code>Sys.setenv(BRM_SEP = "YOUR_CUSTOM_STRING")</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other data: 
<code><a href="brm_data_change.html">brm_data_change</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="brm_simulate_simple.html">brm_simulate_simple</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"col_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 800 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    col_response col_group col_time col_patient</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>        1.47  group_1   time_1   patient_001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>        3.10  group_1   time_2   patient_001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>        2.22  group_1   time_3   patient_001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>        0.215 group_1   time_4   patient_001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>        1.03  group_1   time_1   patient_002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>        2.28  group_1   time_2   patient_002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>        2.36  group_1   time_3   patient_002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>        2.33  group_1   time_4   patient_002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>        0.128 group_1   time_1   patient_003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>        1.89  group_1   time_2   patient_003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 790 more rows</span></span>
<span class="r-in"><span><span class="fu">brm_data</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>  outcome <span class="op">=</span> <span class="st">"col_response"</span>,</span></span>
<span class="r-in"><span>  role <span class="op">=</span> <span class="st">"response"</span>,</span></span>
<span class="r-in"><span>  group <span class="op">=</span> <span class="st">"col_group"</span>,</span></span>
<span class="r-in"><span>  time <span class="op">=</span> <span class="st">"col_time"</span>,</span></span>
<span class="r-in"><span>  patient <span class="op">=</span> <span class="st">"col_patient"</span>,</span></span>
<span class="r-in"><span>  reference_group <span class="op">=</span> <span class="st">"group_1"</span>,</span></span>
<span class="r-in"><span>  reference_time <span class="op">=</span> <span class="st">"time_1"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 800 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    col_response col_group col_time col_patient</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>        1.47  group_1   time_1   patient_001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>        3.10  group_1   time_2   patient_001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>        2.22  group_1   time_3   patient_001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>        0.215 group_1   time_4   patient_001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>        1.03  group_1   time_1   patient_002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>        2.28  group_1   time_2   patient_002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>        2.36  group_1   time_3   patient_002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>        2.33  group_1   time_4   patient_002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>        0.128 group_1   time_1   patient_003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>        1.89  group_1   time_2   patient_003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 790 more rows</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by William Michael Landau, Kevin Kunzmann, Yoni Sidi, Christian Stock, Eli Lilly and Company, Boehringer Ingelheim Pharma GmbH &amp; Co. KG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

