<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Build a model formula for an MMRM, either for a generic
brm_data() dataset or an informative prior archetype."><title>Model formula — brm_formula • brms.mmrm</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Model formula — brm_formula"><meta property="og:description" content="Build a model formula for an MMRM, either for a generic
brm_data() dataset or an informative prior archetype."><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">brms.mmrm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1.9002</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Usage</h6>
    <a class="dropdown-item" href="../articles/usage.html">Usage</a>
    <a class="dropdown-item" href="../articles/subgroup.html">Subgroup analysis</a>
    <a class="dropdown-item" href="../articles/simulation.html">Simulation</a>
    <a class="dropdown-item" href="../articles/archetypes.html">Informative prior archetypes</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Validation</h6>
    <a class="dropdown-item" href="../articles/sbc.html">Simulation-based calibration checking</a>
    <a class="dropdown-item" href="../articles/fev1.html">FEV1 data comparison between Bayesian and frequentist MMRMs</a>
    <a class="dropdown-item" href="../articles/bcva.html">BCVA data comparison between Bayesian and frequentist MMRMs</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/openpharma/brms.mmrm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Model formula</h1>
      <small class="dont-index">Source: <a href="https://github.com/openpharma/brms.mmrm/blob/HEAD/R/brm_formula.R" class="external-link"><code>R/brm_formula.R</code></a></small>
      <div class="d-none name"><code>brm_formula.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Build a model formula for an MMRM, either for a generic
<code><a href="brm_data.html">brm_data()</a></code> dataset or an informative prior archetype.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">brm_formula</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  check_rank <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fu">brms.mmrm</span><span class="fu">::</span><span class="fu"><a href="brm_formula_sigma.html">brm_formula_sigma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, check_rank <span class="op">=</span> <span class="va">check_rank</span><span class="op">)</span>,</span>
<span>  correlation <span class="op">=</span> <span class="st">"unstructured"</span>,</span>
<span>  autoregressive_order <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  moving_average_order <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  residual_covariance_arma_estimation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for default</span></span>
<span><span class="fu">brm_formula</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  check_rank <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fu">brms.mmrm</span><span class="fu">::</span><span class="fu"><a href="brm_formula_sigma.html">brm_formula_sigma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, check_rank <span class="op">=</span> <span class="va">check_rank</span><span class="op">)</span>,</span>
<span>  correlation <span class="op">=</span> <span class="st">"unstructured"</span>,</span>
<span>  autoregressive_order <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  moving_average_order <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  residual_covariance_arma_estimation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  intercept <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  baseline <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"brm_baseline"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  baseline_subgroup <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"brm_baseline"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>    <span class="st">"brm_subgroup"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  baseline_subgroup_time <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"brm_baseline"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>    <span class="st">"brm_subgroup"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  baseline_time <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"brm_baseline"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  covariates <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  group <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  group_subgroup <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"brm_subgroup"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  group_subgroup_time <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"brm_subgroup"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  group_time <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  subgroup <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"brm_subgroup"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  subgroup_time <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"brm_subgroup"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  time <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  effect_baseline <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  effect_group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  effect_time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  interaction_baseline <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  interaction_group <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for brms_mmrm_archetype</span></span>
<span><span class="fu">brm_formula</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  check_rank <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fu">brms.mmrm</span><span class="fu">::</span><span class="fu"><a href="brm_formula_sigma.html">brm_formula_sigma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, check_rank <span class="op">=</span> <span class="va">check_rank</span><span class="op">)</span>,</span>
<span>  correlation <span class="op">=</span> <span class="st">"unstructured"</span>,</span>
<span>  autoregressive_order <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  moving_average_order <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  residual_covariance_arma_estimation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>A classed data frame from <code><a href="brm_data.html">brm_data()</a></code>, or an informative
prior archetype from a function like <code><a href="brm_archetype_successive_cells.html">brm_archetype_successive_cells()</a></code>.</p></dd>


<dt>check_rank</dt>
<dd><p><code>TRUE</code> to check the rank of the model matrix and
throw an error if rank deficiency is detected. <code>FALSE</code> to skip
this check. Rank-deficient models may have non-identifiable
parameters and it is recommended to choose a full-rank mapping.</p></dd>


<dt>sigma</dt>
<dd><p>A formula produced by <code><a href="brm_formula_sigma.html">brm_formula_sigma()</a></code>.
The formula is a base R formula with S3 class
<code>"brms_mmrm_formula_sigma"</code>, and it controls
the parameterization of the residual standard deviations <code>sigma</code>.</p></dd>


<dt>correlation</dt>
<dd><p>Character of length 1, name of the correlation
structure. The correlation matrix is a square <code>T x T</code> matrix, where
<code>T</code> is the number of discrete time points in the data.
This matrix describes the correlations between time points in the same
patient, as modeled in the residuals. Different patients are modeled
as independent. The <code>correlation</code> argument controls how this matrix
is parameterized, and the choices given by <code>brms</code> are listed at
<a href="https://paul-buerkner.github.io/brms/reference/autocor-terms.html" class="external-link">https://paul-buerkner.github.io/brms/reference/autocor-terms.html</a>,
and the choice is ultimately encoded in the main body of the
output formula through terms like <code>unstru()</code> and <code>arma()</code>, some
of which are configurable through arguments
<code>autoregressive_order</code>, <code>moving_average_order</code>, and
<code>residual_covariance_arma_estimation</code> of <code>brm_formula()</code>.
Choices in <code>brms.mmrm</code>:</p><ul><li><p><code>"unstructured"</code>: the default/recommended option, a fully parameterized
covariance matrix with a unique scalar parameter for each unique pair
of discrete time points. C.f.
<a href="https://paul-buerkner.github.io/brms/reference/unstr.html" class="external-link">https://paul-buerkner.github.io/brms/reference/unstr.html</a>.</p></li>
<li><p><code>"autoregressive_moving_average"</code>: autoregressive moving
average (ARMA), c.f.
<a href="https://paul-buerkner.github.io/brms/reference/arma.html" class="external-link">https://paul-buerkner.github.io/brms/reference/arma.html</a>.</p></li>
<li><p><code>"autoregressive"</code>: autoregressive (AR), c.f.
<a href="https://paul-buerkner.github.io/brms/reference/ar.html" class="external-link">https://paul-buerkner.github.io/brms/reference/ar.html</a>.</p></li>
<li><p><code>"moving_average"</code>: moving average (MA), c.f.
<a href="https://paul-buerkner.github.io/brms/reference/ma.html" class="external-link">https://paul-buerkner.github.io/brms/reference/ma.html</a>.</p></li>
<li><p><code>"compound_symmetry</code>: compound symmetry, c.f.
<a href="https://paul-buerkner.github.io/brms/reference/cosy.html" class="external-link">https://paul-buerkner.github.io/brms/reference/cosy.html</a>.</p></li>
<li><p><code>"diagonal"</code>: declare independent time points within patients.</p></li>
</ul></dd>


<dt>autoregressive_order</dt>
<dd><p>Nonnegative integer,
autoregressive order for the <code>"autoregressive_moving_average"</code>
and <code>"autoregressive"</code> correlation structures.</p></dd>


<dt>moving_average_order</dt>
<dd><p>Nonnegative integer,
moving average order for the <code>"autoregressive_moving_average"</code>
and <code>"moving_average"</code> correlation structures.</p></dd>


<dt>residual_covariance_arma_estimation</dt>
<dd><p><code>TRUE</code> or <code>FALSE</code>,
whether to estimate ARMA effects using residual covariance matrices.
Directly supplied to the <code>cov</code> argument in <code>brms</code> for
<code>"autoregressive_moving_average"</code>, <code>"autoregressive"</code>, and
<code>"moving_average"</code> correlation structures. C.f.
<a href="https://paul-buerkner.github.io/brms/reference/arma.html" class="external-link">https://paul-buerkner.github.io/brms/reference/arma.html</a>.</p></dd>


<dt>...</dt>
<dd><p>Named arguments to specific <code>brm_formula()</code> methods.</p></dd>


<dt>intercept</dt>
<dd><p>Logical of length 1.
<code>TRUE</code> (default) to include an intercept, <code>FALSE</code> to omit.</p></dd>


<dt>baseline</dt>
<dd><p>Logical of length 1.
<code>TRUE</code> to include an additive effect for baseline
response, <code>FALSE</code> to omit.
Default is <code>TRUE</code> if <code><a href="brm_data.html">brm_data()</a></code> previously declared a baseline
variable in the dataset.
Ignored for informative prior archetypes.
For informative prior archetypes, this option should be set in
functions like <code><a href="brm_archetype_successive_cells.html">brm_archetype_successive_cells()</a></code> rather than in
<code>brm_formula()</code> in order to make sure columns are appropriately
centered and the underlying model matrix has full rank.</p></dd>


<dt>baseline_subgroup</dt>
<dd><p>Logical of length 1.</p></dd>


<dt>baseline_subgroup_time</dt>
<dd><p>Logical of length 1.
<code>TRUE</code> to include baseline-by-subgroup-by-time interaction,
<code>FALSE</code> to omit.
Default is <code>TRUE</code> if <code><a href="brm_data.html">brm_data()</a></code> previously declared baseline
and subgroup variables in the dataset.
Ignored for informative prior archetypes.
For informative prior archetypes, this option should be set in
functions like <code><a href="brm_archetype_successive_cells.html">brm_archetype_successive_cells()</a></code> rather than in
<code>brm_formula()</code> in order to make sure columns are appropriately
centered and the underlying model matrix has full rank.</p></dd>


<dt>baseline_time</dt>
<dd><p>Logical of length 1.
<code>TRUE</code> to include baseline-by-time interaction, <code>FALSE</code> to omit.
Default is <code>TRUE</code> if <code><a href="brm_data.html">brm_data()</a></code> previously declared a baseline
variable in the dataset.
Ignored for informative prior archetypes.
For informative prior archetypes, this option should be set in
functions like <code><a href="brm_archetype_successive_cells.html">brm_archetype_successive_cells()</a></code> rather than in
<code>brm_formula()</code> in order to make sure columns are appropriately
centered and the underlying model matrix has full rank.</p></dd>


<dt>covariates</dt>
<dd><p>Logical of length 1.
<code>TRUE</code> (default) to include any additive covariates declared with
the <code>covariates</code> argument of <code><a href="brm_data.html">brm_data()</a></code>,
<code>FALSE</code> to omit.
For informative prior archetypes, this option is set in
functions like <code><a href="brm_archetype_successive_cells.html">brm_archetype_successive_cells()</a></code> rather than in
<code>brm_formula()</code> in order to make sure columns are appropriately
centered and the underlying model matrix has full rank.</p></dd>


<dt>group</dt>
<dd><p>Logical of length 1.
<code>TRUE</code> (default) to include additive effects for
treatment groups, <code>FALSE</code> to omit.</p></dd>


<dt>group_subgroup</dt>
<dd><p>Logical of length 1.
<code>TRUE</code> to include group-by-subgroup interaction, <code>FALSE</code> to omit.
Default is <code>TRUE</code> if <code><a href="brm_data.html">brm_data()</a></code> previously declared a subgroup
variable in the dataset.</p></dd>


<dt>group_subgroup_time</dt>
<dd><p>Logical of length 1.
<code>TRUE</code> to include group-by-subgroup-by-time interaction, <code>FALSE</code> to omit.
Default is <code>TRUE</code> if <code><a href="brm_data.html">brm_data()</a></code> previously declared a subgroup
variable in the dataset.</p></dd>


<dt>group_time</dt>
<dd><p>Logical of length 1.
<code>TRUE</code> (default) to include group-by-time interaction, <code>FALSE</code> to omit.</p></dd>


<dt>subgroup</dt>
<dd><p>Logical of length 1.
<code>TRUE</code> to include additive fixed effects for subgroup levels,
<code>FALSE</code> to omit.
Default is <code>TRUE</code> if <code><a href="brm_data.html">brm_data()</a></code> previously declared a subgroup
variable in the dataset.</p></dd>


<dt>subgroup_time</dt>
<dd><p>Logical of length 1.
<code>TRUE</code> to include subgroup-by-time interaction, <code>FALSE</code> to omit.
Default is <code>TRUE</code> if <code><a href="brm_data.html">brm_data()</a></code> previously declared a subgroup
variable in the dataset.</p></dd>


<dt>time</dt>
<dd><p>Logical of length 1.
<code>TRUE</code> (default) to include a additive effect for discrete time,
<code>FALSE</code> to omit.</p></dd>


<dt>effect_baseline</dt>
<dd><p>Deprecated on 2024-01-16 (version 0.0.2.9002).
Use <code>baseline</code> instead.</p></dd>


<dt>effect_group</dt>
<dd><p>Deprecated on 2024-01-16 (version 0.0.2.9002).
Use <code>group</code> instead.</p></dd>


<dt>effect_time</dt>
<dd><p>Deprecated on 2024-01-16 (version 0.0.2.9002).
Use <code>time</code> instead.</p></dd>


<dt>interaction_baseline</dt>
<dd><p>Deprecated on 2024-01-16 (version 0.0.2.9002).
Use <code>baseline_time</code> instead.</p></dd>


<dt>interaction_group</dt>
<dd><p>Deprecated on 2024-01-16 (version 0.0.2.9002).
Use <code>group_time</code> instead.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An object of class <code>"brmsformula"</code> returned from
<code><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html" class="external-link">brms::brmsformula()</a></code>. It contains the fixed effect mapping,
correlation structure, and residual variance structure.</p>
    </div>
    <div class="section level2">
    <h2 id="brm-data-formulas"><code><a href="brm_data.html">brm_data()</a></code> formulas<a class="anchor" aria-label="anchor" href="#brm-data-formulas"></a></h2>
    

<p>For a <code><a href="brm_data.html">brm_data()</a></code> dataset,
<code>brm_formula()</code> builds an R formula for an MMRM based on
the details in the data and your choice of mapping.
Customize your mapping by toggling on or off
the various <code>TRUE</code>/<code>FALSE</code> arguments of <code>brm_formula()</code>,
such as <code>intercept</code>, <code>baseline</code>, and <code>group_time</code>.
All plausible additive effects, two-way interactions, and
three-way interactions can be specified. The following interactions
are not supported:</p><ul><li><p>Any interactions with the concomitant covariates you specified in the
<code>covariates</code> argument of <code><a href="brm_data.html">brm_data()</a></code>.</p></li>
<li><p>Any interactions which include baseline response and treatment
group together. Rationale: in a randomized controlled experiment,
baseline and treatment group assignment should be uncorrelated.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="formulas-for-informative-prior-archetypes">Formulas for informative prior archetypes<a class="anchor" aria-label="anchor" href="#formulas-for-informative-prior-archetypes"></a></h2>
    

<p>Functions like <code><a href="brm_archetype_successive_cells.html">brm_archetype_successive_cells()</a></code>
tailor datasets to informative prior archetypes. For these specialized
tailored datasets, <code>brm_formula()</code> works differently. It still applies
the variance and correlation structure of your choosing, and it still
lets you choose whether to adjust for nuisance covariates,
but it no longer lets you toggle on/off individual terms in the model,
such as <code>intercept</code>, <code>baseline</code>, or <code>group</code>. Instead, to ensure the
correct interpretation of the parameters, <code>brm_formula()</code> uses
the <code>x_*</code> and <code>nuisance_*</code> columns generated by
<code>brm_archetype_successive_cells( prefix_interest = "x_", prefix_nuisance = "nuisance_")</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="parameterization">Parameterization<a class="anchor" aria-label="anchor" href="#parameterization"></a></h2>
    

<p>For a formula on a <code><a href="brm_data.html">brm_data()</a></code> dataset,
the formula is not the only factor
that determines the fixed effect mapping.
The ordering of the categorical variables in the data,
as well as the <code>contrast</code> option in R, affect the
construction of the model matrix. To see the model
matrix that will ultimately be used in <code><a href="brm_model.html">brm_model()</a></code>,
run <code><a href="https://paul-buerkner.github.io/brms/reference/standata.html" class="external-link">brms::make_standata()</a></code> and examine the <code>X</code> element
of the returned list. See the examples below for a
demonstration.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other models: 
<code><a href="brm_formula_sigma.html">brm_formula_sigma</a>()</code>,
<code><a href="brm_model.html">brm_model</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="brm_data.html">brm_data</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="fu"><a href="brm_simulate_simple.html">brm_simulate_simple</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">data</span>,</span></span>
<span class="r-in"><span>  outcome <span class="op">=</span> <span class="st">"response"</span>,</span></span>
<span class="r-in"><span>  role <span class="op">=</span> <span class="st">"response"</span>,</span></span>
<span class="r-in"><span>  group <span class="op">=</span> <span class="st">"group"</span>,</span></span>
<span class="r-in"><span>  time <span class="op">=</span> <span class="st">"time"</span>,</span></span>
<span class="r-in"><span>  patient <span class="op">=</span> <span class="st">"patient"</span>,</span></span>
<span class="r-in"><span>  reference_group <span class="op">=</span> <span class="st">"group_1"</span>,</span></span>
<span class="r-in"><span>  reference_time <span class="op">=</span> <span class="st">"time_1"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">brm_formula</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> response ~ group + group:time + time + unstr(time = time, gr = patient) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma ~ 0 + time</span>
<span class="r-in"><span><span class="fu">brm_formula</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span>, baseline <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> response ~ 0 + group + group:time + time + unstr(time = time, gr = patient) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma ~ 0 + time</span>
<span class="r-in"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu">brm_formula</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>  intercept <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  baseline <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  group <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">formula</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> response ~ 0 + group:time + time + unstr(time = time, gr = patient) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma ~ 0 + time</span>
<span class="r-in"><span><span class="co"># Standard deviations of residuals are distributional parameters that can</span></span></span>
<span class="r-in"><span><span class="co"># regress on variables in the data.</span></span></span>
<span class="r-in"><span><span class="va">homogeneous</span> <span class="op">&lt;-</span> <span class="fu"><a href="brm_formula_sigma.html">brm_formula_sigma</a></span><span class="op">(</span><span class="va">data</span>, time <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">by_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="brm_formula_sigma.html">brm_formula_sigma</a></span><span class="op">(</span><span class="va">data</span>, group <span class="op">=</span> <span class="cn">TRUE</span>, intercept <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">homogeneous</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma ~ 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"brm_allow_effect_size")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x564586bc6460&gt;</span>
<span class="r-in"><span><span class="va">by_group</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma ~ group + time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"brm_allow_effect_size")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x564587fdf068&gt;</span>
<span class="r-in"><span><span class="fu">brm_formula</span><span class="op">(</span><span class="va">data</span>, sigma <span class="op">=</span> <span class="va">homogeneous</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> response ~ group + group:time + time + unstr(time = time, gr = patient) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma ~ 0</span>
<span class="r-in"><span><span class="fu">brm_formula</span><span class="op">(</span><span class="va">data</span>, sigma <span class="op">=</span> <span class="va">by_group</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> response ~ group + group:time + time + unstr(time = time, gr = patient) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma ~ group + time</span>
<span class="r-in"><span><span class="co"># Optional: set the contrast option, which determines the model matrix.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>unordered <span class="op">=</span> <span class="st">"contr.SAS"</span>, ordered <span class="op">=</span> <span class="st">"contr.poly"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># See the fixed effect mapping you get from the data:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/standata.html" class="external-link">make_standata</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   timetime_1 timetime_2 timetime_3 timetime_4 timetime_1:groupgroup_1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1          0          0          0                       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          0          1          0          0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          0          0          1          0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4          0          0          0          1                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          1          0          0          0                       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6          0          1          0          0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   timetime_2:groupgroup_1 timetime_3:groupgroup_1 timetime_4:groupgroup_1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                       0                       0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                       1                       0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                       0                       1                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4                       0                       0                       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                       0                       0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                       1                       0                       0</span>
<span class="r-in"><span><span class="co"># Specify a different contrast method to use an alternative</span></span></span>
<span class="r-in"><span><span class="co"># mapping when fitting the model with brm_model():</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>unordered <span class="op">=</span> <span class="st">"contr.treatment"</span>, ordered <span class="op">=</span> <span class="st">"contr.poly"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># different model matrix than before:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/standata.html" class="external-link">make_standata</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   timetime_1 timetime_2 timetime_3 timetime_4 timetime_1:groupgroup_2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          1          0          0          0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          0          1          0          0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          0          0          1          0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4          0          0          0          1                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          1          0          0          0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6          0          1          0          0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   timetime_2:groupgroup_2 timetime_3:groupgroup_2 timetime_4:groupgroup_2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                       0                       0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                       0                       0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                       0                       0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4                       0                       0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                       0                       0                       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                       0                       0                       0</span>
<span class="r-in"><span><span class="co"># Formula on an informative prior archetype:</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="brm_simulate_outline.html">brm_simulate_outline</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  n_group <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  n_patient <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  n_time <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>  rate_dropout <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>  rate_lapse <span class="op">=</span> <span class="fl">0</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="brm_data_change.html">brm_data_change</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="brm_simulate_continuous.html">brm_simulate_continuous</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"biomarker1"</span>, <span class="st">"biomarker2"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="brm_simulate_categorical.html">brm_simulate_categorical</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    names <span class="op">=</span> <span class="st">"biomarker3"</span>,</span></span>
<span class="r-in"><span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"present"</span>, <span class="st">"absent"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">archetype</span> <span class="op">&lt;-</span> <span class="fu"><a href="brm_archetype_successive_cells.html">brm_archetype_successive_cells</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu">brm_formula</span><span class="op">(</span>data <span class="op">=</span> <span class="va">archetype</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">formula</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> change ~ 0 + x_group_1_time_2 + x_group_1_time_3 + x_group_1_time_4 + x_group_2_time_2 + x_group_2_time_3 + x_group_2_time_4 + nuisance_biomarker1 + nuisance_biomarker2 + nuisance_biomarker3_absent + nuisance_baseline + nuisance_baseline.timetime_2 + nuisance_baseline.timetime_3 + unstr(time = time, gr = patient) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma ~ 0 + time</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by William Michael Landau, Kevin Kunzmann, Yoni Sidi, Christian Stock, Eli Lilly and Company, Boehringer Ingelheim Pharma GmbH &amp; Co. KG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

